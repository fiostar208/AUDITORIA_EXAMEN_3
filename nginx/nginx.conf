# nginx/nginx.conf
server {
    listen 80;

    # AUMENTAR TIMEOUTS PARA IA - NUEVO
    proxy_connect_timeout 60s;
    proxy_send_timeout 60s;
    proxy_read_timeout 300s;

    # NUEVA REGLA: Si la petición es para /metrics, envíala al backend
    location /metrics {
        proxy_pass http://backend:8000/metrics;
        # Timeout específico para métricas
        proxy_read_timeout 30s;
    }

    # Regla existente para la API - CON TIMEOUT AUMENTADO
    location /api/ {
        proxy_pass http://backend:8000/;
        # Timeout aumentado para endpoints de IA
        proxy_read_timeout 300s;
    }

    # REGLA NUEVA: Para /ask directamente
    location /ask {
        proxy_pass http://backend:8000/ask;
        # Timeout máximo para IA
        proxy_read_timeout 300s;
    }

    # Regla existente para el frontend
    location / {
        proxy_pass http://frontend:80;
        # Timeout normal para frontend
        proxy_read_timeout 30s;
    }
}